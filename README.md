# **Domli-ML-**  
<p style="text-align: center;">На этой ветке лежит ml-часть проекта. В настоящее время она находится на стадии альфа-версии, поэтому функциональность и производительность могут существенно измениться по мере разработки.

Тут польный ml-конвейер, работающий на базе лама-моделей. `Главная фича` - ии-агент для выступающий в качестве менеждера по продажам АССК, он отвечает за всё сопровождение клиента по сайту. Система легко обрабатывает аудио в режиме реального времени: преобразует речь в текст, интерпретирует запросы с помощью языковой модели, оборабатывает запросы, синтезирует ответы обратно в речь и помогает в навигации на сайте. Также в пакете `tools` реализованы функции, благодаря ктором он может обращаться к БД и выдвать оттуда объекты недвижисоти с учетом запросов пользовтеля. Модели дообучены на данных застройщика, есть информация по компаних, их объектам и характристиках. 
</p>

---

### **Преимущества**
- Понимание языка: архитектура построена на базе моделей LLaMA, что позволяет ей глубоко понимать контекст диалогов и естественно общаться с пользователем.
- Память: все диалоги автоматически сохраняются, что позволяет ии отследивать констекст.
- Гибкость: чистая и модульная архитектура позволяет быстро добавлять новые функции в пайплайн ии-агента.
- Актульаность данных: встроен парсер объявлений с Avito и сайтов застройщиков, система собирает данные по таймеру.
- Мульти-язычность: Whisper умеет режиме реального времени анализировать язык пользователя.

---

### **Обзор Пайплайна**
1. **Преобразование речи в текст:**
   - Голос записывается с автоматическим обрезанием пауз (таймер «молчания»), чтобы фиксировать только живую речь.
   - `UVR-MDX-NET-Inst_HQ_4` очищает звук, выделяет голос, делает сэмплинг спектрограммы и повышает качество («апскейлит» сигнал).
   - `Whisper-medium-v3 ` преобразует полученную аудиодорожку в текст — с поддержкой нескольких языков.

2. **Генерация ответа на основе текста:**
   - Распознанный текст передаётся на вход одной из LLaMA моделей
     - `DeepSeek-R1-Distill-Qwen-14B-Q4_0` - качество;
     - `Meta-Llama-3-8B-Instruct.Q4_0` - скорость.
   -  Проверка ответа на галлюцинации, если на прошла - вспоминает историю и обновляет метаданные.

3. **Модуль с промтами и диалогом:**
   - Специальный «строитель подсказок» (prompt builder) задаёт роль бота, тон общения и ограничения на длину/форму ответа.
   - В каждое сообщение автоматически «вкладывается» контекст от пользователя.
   - An example of a real dialogue:
```
| User_input|
|--------------------------|
| Привет! Я хочу подобрать для себя недвижимость. Какие есть предложения и игроки на рынке?|

| Assistant_output|
|--------------------------|
| Привет! Я рада помочь вам разобраться в лучших предложениях Ассоциации застройщиков Краснодарского края. АЗКК - это организация, в которую входят...|
```

4. **Синтез речи:**
- `XTTS-v2-multi` генерирует естественную, «живую» речь с реалистичной интонацией и ритмом, поддерживая несколько языков.
- Есть «клонирование» голоса, достаточно 3-5 сек. образца и система сможет говорить любым текстом на любом языке этим же голосом.

---

### Структура проекта

```
domli/
│
│
├── config.py 			   # Настройки конфигурации
├── fast_api.bash                  # Скрипт для запуска FastApi
├── main.py                        # Главный скрипт
│
│
├── chromedriver/                  # Драйвер браузера для парсинга
│
│
│
├── db_connector/              	   # === БД PostgreSQL ===
│   ├── __init__.py
│   ├── engine.py 		   # Получение / возврат соединений
│   ├── extractor.py 		   # SQL запросы + таблицы
│   └── writer.py 	   	   # Отправка результата на сервер
│
│
│
├── audio_processing/              # === Процессинг аудио (speech to speech pipline) ===
│   ├── __init__.py
│   ├── to_audio.py 		   # Синтез голосового ответа
│   ├── to_text.py 		   # Транскрибирование
│   └── vocal_selector.py 	   # Предобработка голоса
│
│
│
├── agent_core/                    # === Логика агента ===
│   ├── __init__.py
│   ├── factory.py 		   # Инициализация
│   ├── llma.py 		   # Обёртка над gpt4all
│   ├── run_agent.py 		   # Запуск агента
│   └── tools.py 	           # Системные инструменты
│
│
│
├── llama_agent/                   # === Пайпайлн ассистента ===
│   ├── __init__.py
│   ├── dialog_manager.py 	   # Отслеживает шаги, обновляет историю, координирует элементы
│   ├── llama_response.py 	   # Класс llama-модели + контекст
│   └── prompt_engineer.py 	   # Систменые промты
│
│
│
├── models/                        # === Файлы моделей, их параметры и логи ===
│   │    		   
│   ├── whisper 		   # Голос (вход) в текст		   
│   ├── mdx_net 		   # Нормализация и очистка аудио
│   ├── tts_multi 		   # Текст (выход) в речь
│   └── meta_llama 		   # Дистилированные llama
│
│
│
├── scraping/                      # === Веб-скрейпинг ===
│   ├── __init__.py
│   ├── scr_config.py 		   # Настройки конфигурации
│   ├── scr_base.py 		   # Для сайтов застройщиков
│   ├── scr_net.py 		   # Для авито
│   └── scheduler_run.py 	   # Планировщик и обновления
│
│
│
├── data/                          # === Данные проекта ===
│   │
│   ├── company/ 		   # Профили застройщиков
│   ├── real_estate/ 		   # Объекты недвижимости
│   ├── speech/ 		   # Голосовые вход/выход
│   ├── text/ 			   # История чата
│   └── voices/ 		   # Образец голоса
│
│
│
├── requirements.txt
├── structure.txt
│
│
├── .gitattributes
└── README.md
```
---
